<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üîß ToolManager AI ‚Äî –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤</title>
  <link rel="icon" href="image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üîß</text></svg>">
  <style>
    :root {
      --primary: #667eea;
      --primary-dark: #5568d3;
      --secondary: #764ba2;
      --success: #28a745;
      --error: #dc3545;
      --warning: #ffc107;
      --light: #f8f9fa;
      --dark: #343a40;
      --gray: #6c757d;
      --border-radius: 12px;
      --shadow: 0 4px 20px rgba(0,0,0,0.08);
      --shadow-hover: 0 8px 30px rgba(0,0,0,0.12);
      --transition: all 0.3s ease;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      line-height: 1.6;
      color: #333;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: var(--border-radius);
      padding: 25px;
      margin-bottom: 25px;
      box-shadow: var(--shadow);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 20px;
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 15px;
      font-size: 1.8rem;
      font-weight: 800;
      color: var(--primary);
    }
    
    .logo-icon {
      font-size: 2.5rem;
    }
    
    .stats-bar {
      display: flex;
      gap: 30px;
      color: var(--dark);
      font-weight: 600;
    }
    
    .stat-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 20px;
      background: rgba(102, 126, 234, 0.1);
      border-radius: 50px;
      border: 2px solid var(--primary);
    }
    
    .stat-icon {
      font-size: 1.4rem;
    }
    
    .stat-value {
      font-size: 1.3rem;
      color: var(--primary);
    }
    
    .storage-info {
      background: rgba(255, 255, 255, 0.95);
      border-radius: var(--border-radius);
      padding: 15px 25px;
      margin-bottom: 25px;
      box-shadow: var(--shadow);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 15px;
      border-left: 4px solid var(--warning);
    }
    
    .storage-text {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 600;
      color: var(--dark);
    }
    
    .storage-bar {
      flex: 1;
      max-width: 300px;
      height: 20px;
      background: #e9ecef;
      border-radius: 10px;
      overflow: hidden;
    }
    
    .storage-fill {
      height: 100%;
      background: var(--primary);
      border-radius: 10px;
      transition: width 0.3s ease;
    }
    
    .clear-btn {
      background: var(--error);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 50px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .clear-btn:hover {
      background: #c82333;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
    }
    
    .status-card {
      background: rgba(255, 255, 255, 0.95);
      border-radius: var(--border-radius);
      padding: 20px;
      margin-bottom: 25px;
      box-shadow: var(--shadow);
      text-align: center;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      border-left: 4px solid #ccc;
    }
    
    .status-card.ok {
      background: rgba(40, 167, 69, 0.1);
      color: #155724;
      border-left-color: var(--success);
    }
    
    .status-card.error {
      background: rgba(220, 53, 69, 0.1);
      color: #721c24;
      border-left-color: var(--error);
    }
    
    .status-card.warning {
      background: rgba(255, 193, 7, 0.1);
      color: #856404;
      border-left-color: var(--warning);
    }
    
    .status-icon {
      font-size: 1.5rem;
    }
    
    .upload-area {
      background: rgba(255, 255, 255, 0.95);
      border-radius: var(--border-radius);
      padding: 60px 40px;
      text-align: center;
      cursor: pointer;
      margin-bottom: 30px;
      box-shadow: var(--shadow);
      transition: var(--transition);
      border: 3px dashed #dee2e6;
    }
    
    .upload-area:hover {
      border-color: var(--primary);
      transform: translateY(-5px);
      box-shadow: var(--shadow-hover);
      background: rgba(255, 255, 255, 1);
    }
    
    .upload-icon {
      font-size: 5rem;
      margin-bottom: 20px;
      color: var(--primary);
      opacity: 0.8;
    }
    
    .upload-title {
      font-size: 2rem;
      font-weight: 800;
      color: var(--dark);
      margin-bottom: 15px;
    }
    
    .upload-hint {
      font-size: 1.2rem;
      color: var(--gray);
      margin-bottom: 10px;
    }
    
    .upload-subhint {
      font-size: 0.95rem;
      color: #6c757d;
      margin-top: 8px;
    }
    
    .gallery {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 25px;
      margin-bottom: 30px;
    }
    
    .tool-card {
      background: rgba(255, 255, 255, 0.95);
      border-radius: var(--border-radius);
      overflow: hidden;
      box-shadow: var(--shadow);
      transition: var(--transition);
      position: relative;
    }
    
    .tool-card:hover {
      transform: translateY(-10px);
      box-shadow: var(--shadow-hover);
    }
    
    .tool-image {
      width: 100%;
      height: 220px;
      object-fit: cover;
      display: block;
    }
    
    .tool-content {
      padding: 25px;
    }
    
    .tool-name {
      font-size: 1.5rem;
      font-weight: 800;
      color: var(--dark);
      margin-bottom: 12px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    .tool-type {
      display: inline-block;
      background: var(--primary);
      color: white;
      padding: 8px 20px;
      border-radius: 50px;
      font-size: 0.95rem;
      font-weight: 600;
      margin-bottom: 15px;
    }
    
    .tool-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-top: 15px;
      border-top: 1px solid #e9ecef;
      color: var(--gray);
      font-size: 0.95rem;
    }
    
    .tool-confidence {
      background: var(--success);
      color: white;
      padding: 4px 12px;
      border-radius: 15px;
      font-size: 0.85rem;
      font-weight: 600;
    }
    
    .empty-state {
      grid-column: 1 / -1;
      text-align: center;
      padding: 80px 20px;
    }
    
    .empty-icon {
      font-size: 6rem;
      margin-bottom: 25px;
      opacity: 0.3;
      color: white;
    }
    
    .empty-title {
      font-size: 2rem;
      color: rgba(255, 255, 255, 0.95);
      margin-bottom: 15px;
      font-weight: 700;
    }
    
    .empty-text {
      font-size: 1.2rem;
      color: rgba(255, 255, 255, 0.8);
      margin-bottom: 30px;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }
    
    .empty-button {
      background: var(--primary);
      color: white;
      border: none;
      padding: 15px 40px;
      border-radius: 50px;
      font-size: 1.1rem;
      font-weight: 700;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      gap: 10px;
      box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
    }
    
    .empty-button:hover {
      background: var(--primary-dark);
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
    }
    
    footer {
      text-align: center;
      padding: 30px;
      color: rgba(255, 255, 255, 0.8);
      font-size: 1rem;
      margin-top: 20px;
    }
    
    .footer-links {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 10px;
    }
    
    .footer-links a {
      color: white;
      text-decoration: none;
      font-weight: 600;
      transition: opacity 0.3s ease;
    }
    
    .footer-links a:hover {
      opacity: 0.8;
    }
    
    .notification {
      position: fixed;
      top: 25px;
      right: 25px;
      padding: 16px 25px;
      border-radius: 12px;
      color: white;
      font-weight: 700;
      font-size: 1.05rem;
      box-shadow: 0 8px 25px rgba(0,0,0,0.2);
      transform: translateX(500px);
      transition: transform 0.35s ease;
      z-index: 10000;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .notification.show {
      transform: translateX(0);
    }
    
    .notification.success {
      background: var(--success);
    }
    
    .notification.error {
      background: var(--error);
    }
    
    .notification.warning {
      background: var(--warning);
      color: #333;
    }
    
    .notification-icon {
      font-size: 1.4rem;
    }
    
    .loading {
      text-align: center;
      padding: 60px 20px;
      color: white;
    }
    
    .spinner {
      border: 5px solid rgba(255, 255, 255, 0.3);
      border-top-color: white;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 0 auto 25px;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .badge {
      position: absolute;
      top: 15px;
      right: 15px;
      background: var(--primary);
      color: white;
      padding: 6px 15px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      z-index: 20000;
      justify-content: center;
      align-items: center;
    }
    
    .modal.active {
      display: flex;
    }
    
    .modal-content {
      background: white;
      border-radius: var(--border-radius);
      max-width: 90%;
      max-height: 90%;
      overflow-y: auto;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    }
    
    .modal-header {
      background: var(--primary);
      color: white;
      padding: 20px 25px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .modal-title {
      font-size: 1.4rem;
      font-weight: 700;
    }
    
    .modal-close {
      background: none;
      border: none;
      color: white;
      font-size: 1.8rem;
      cursor: pointer;
      padding: 0;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: var(--transition);
    }
    
    .modal-close:hover {
      background: rgba(255,255,255,0.2);
    }
    
    .modal-body {
      padding: 30px;
      min-width: 600px;
    }
    
    .compare-section {
      margin-bottom: 30px;
    }
    
    .compare-title {
      font-size: 1.3rem;
      color: var(--dark);
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .compare-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    .compare-item {
      border: 2px solid #dee2e6;
      border-radius: var(--border-radius);
      padding: 15px;
      text-align: center;
      cursor: pointer;
      transition: var(--transition);
      background: white;
    }
    
    .compare-item:hover {
      border-color: var(--warning);
      transform: scale(1.03);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .compare-item.similar {
      border-color: var(--success);
      background: rgba(40, 167, 69, 0.05);
    }
    
    .compare-item img {
      width: 100%;
      height: 150px;
      object-fit: cover;
      border-radius: 8px;
      margin-bottom: 10px;
    }
    
    .compare-name {
      font-weight: 600;
      color: var(--dark);
      margin-bottom: 5px;
    }
    
    .compare-type {
      font-size: 0.85rem;
      color: var(--gray);
      margin-bottom: 10px;
    }
    
    .compare-score {
      font-size: 0.9rem;
      color: var(--success);
      font-weight: 600;
      background: rgba(40, 167, 69, 0.1);
      padding: 4px 10px;
      border-radius: 15px;
      display: inline-block;
    }
    
    .compare-actions {
      display: flex;
      gap: 15px;
      margin-top: 25px;
      justify-content: center;
    }
    
    .btn {
      padding: 12px 30px;
      border: none;
      border-radius: 50px;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    
    .btn-primary {
      background: var(--primary);
      color: white;
    }
    
    .btn-primary:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }
    
    .btn-secondary {
      background: var(--gray);
      color: white;
    }
    
    .btn-secondary:hover {
      background: #5a6268;
      transform: translateY(-2px);
    }
    
    .btn-danger {
      background: var(--error);
      color: white;
    }
    
    .btn-danger:hover {
      background: #c82333;
      transform: translateY(-2px);
    }
    
    .compare-info {
      background: #e7f3ff;
      border-left: 4px solid var(--primary);
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-size: 0.95rem;
    }
    
    .compare-info strong {
      color: var(--primary);
    }
    
    /* –§–æ—Ä–º–∞ —Ä—É—á–Ω–æ–π –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ */
    .edit-form {
      padding: 20px;
      background: #f8f9fa;
      border-radius: 8px;
      margin-top: 20px;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    .form-group label {
      display: block;
      font-weight: 600;
      margin-bottom: 5px;
      color: var(--dark);
    }
    
    .form-group input,
    .form-group select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ced4da;
      border-radius: 4px;
      font-size: 1rem;
    }
    
    .form-group input[type="range"] {
      padding: 0;
      height: 8px;
    }
    
    .confidence-display {
      text-align: center;
      font-size: 0.9rem;
      color: var(--gray);
      margin-top: 5px;
    }
    
    /* –î–µ—Ç–∞–ª—å–Ω—ã–π –≤–∏–¥ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ */
    .tool-detail {
      background: white;
      border-radius: var(--border-radius);
      padding: 30px;
      margin-top: 20px;
      box-shadow: var(--shadow);
    }
    
    .detail-title {
      font-size: 1.8rem;
      font-weight: 800;
      color: var(--dark);
      margin-bottom: 20px;
      border-bottom: 2px solid var(--primary);
      padding-bottom: 10px;
    }
    
    .detail-row {
      display: flex;
      margin-bottom: 15px;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 8px;
    }
    
    .detail-label {
      font-weight: 600;
      color: var(--dark);
      min-width: 120px;
    }
    
    .detail-value {
      color: var(--gray);
    }
    
    .detail-features,
    .detail-materials,
    .detail-usage {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    
    .detail-features li,
    .detail-materials li,
    .detail-usage li {
      padding: 5px 0;
      color: var(--gray);
      position: relative;
      padding-left: 20px;
    }
    
    .detail-features li:before,
    .detail-materials li:before,
    .detail-usage li:before {
      content: "‚Ä¢";
      position: absolute;
      left: 0;
      color: var(--primary);
      font-weight: bold;
    }
    
    @media (max-width: 768px) {
      header {
        flex-direction: column;
        text-align: center;
      }
      
      .stats-bar {
        gap: 15px;
        flex-wrap: wrap;
        justify-content: center;
      }
      
      .upload-area {
        padding: 40px 20px;
      }
      
      .upload-icon {
        font-size: 3.5rem;
      }
      
      .upload-title {
        font-size: 1.6rem;
      }
      
      .gallery {
        grid-template-columns: 1fr;
      }
      
      .storage-info {
        flex-direction: column;
        text-align: center;
      }
      
      .modal-body {
        min-width: auto;
        padding: 20px;
      }
      
      .compare-grid {
        grid-template-columns: 1fr;
      }
    }
    
    @media (max-width: 480px) {
      body {
        padding: 10px;
      }
      
      header {
        padding: 15px;
      }
      
      .logo {
        font-size: 1.5rem;
      }
      
      .logo-icon {
        font-size: 2rem;
      }
      
      .stat-item {
        padding: 8px 15px;
        font-size: 0.9rem;
      }
      
      .upload-icon {
        font-size: 2.5rem;
      }
      
      .upload-title {
        font-size: 1.4rem;
      }
      
      .empty-icon {
        font-size: 4rem;
      }
      
      .empty-title {
        font-size: 1.6rem;
      }
      
      .empty-text {
        font-size: 1rem;
      }
      
      .btn {
        padding: 10px 20px;
        font-size: 0.95rem;
      }
      
      .modal-body {
        padding: 15px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">
        <span class="logo-icon">üîß</span>
        <span>ToolManager AI</span>
      </div>
      <div class="stats-bar">
        <div class="stat-item">
          <span class="stat-icon">üìÅ</span>
          <span class="stat-value" id="total-count">0</span>
          <span>–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤</span>
        </div>
        <div class="stat-item">
          <span class="stat-icon">ü§ñ</span>
          <span class="stat-value" id="ai-count">0</span>
          <span>—Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–æ</span>
        </div>
        <div class="stat-item">
          <span class="stat-icon">üíæ</span>
          <span class="stat-value" id="tools-count">0</span>
          <span>/ 50</span>
        </div>
      </div>
    </header>
    
    <div class="storage-info">
      <div class="storage-text">
        <span>üíæ –•—Ä–∞–Ω–∏–ª–∏—â–µ:</span>
        <span id="storage-usage">0</span>%
      </div>
      <div class="storage-bar">
        <div class="storage-fill" id="storage-fill" style="width: 0%"></div>
      </div>
      <button class="clear-btn" onclick="clearOldTools()">
        <span>üóëÔ∏è</span>
        <span>–û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ</span>
      </button>
    </div>
    
    <div class="status-card" id="server-status">
      <div class="spinner" style="width: 25px; height: 25px; border-width: 3px;"></div>
      <span>‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É...</span>
    </div>
    
    <div class="upload-area" id="drop-area">
      <div class="upload-icon">üì∑</div>
      <h1 class="upload-title">–î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞</h1>
      <p class="upload-hint">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª —Å—é–¥–∞ –∏–ª–∏ –∫–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</p>
      <p class="upload-subhint">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è JPG, PNG, WEBP ‚Ä¢ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 10 –ú–ë</p>
      <input type="file" id="file-input" accept="image/*" hidden multiple>
    </div>
    
    <div class="gallery" id="gallery">
      <div class="empty-state">
        <div class="empty-icon">üìÅ</div>
        <h2 class="empty-title">–ù–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤</h2>
        <p class="empty-text">
          –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —Å –ø–æ–º–æ—â—å—é –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞
        </p>
        <button class="empty-button" onclick="document.getElementById('file-input').click()">
          <span>üì∑</span>
          <span>–î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ</span>
        </button>
      </div>
    </div>
    
    <footer>
      <p>ToolManager AI ¬© 2026 | –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —Å –ø–æ–º–æ—â—å—é –ò–ò</p>
      <div class="footer-links">
        <a href="#" onclick="showAbout()">–û –ø—Ä–æ–µ–∫—Ç–µ</a>
        <span>‚Ä¢</span>
        <a href="#" onclick="showHelp()">–ü–æ–º–æ—â—å</a>
        <span>‚Ä¢</span>
        <a href="https://github.com/om641228-ux/toolmanager-ai" target="_blank">GitHub</a>
      </div>
    </footer>
  </div>
  
  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ -->
  <div class="modal" id="compare-modal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">üîç –ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤</div>
        <button class="modal-close" id="modal-close">&times;</button>
      </div>
      <div class="modal-body" id="modal-body">
        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
      </div>
    </div>
  </div>
  
  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ -->
  <div class="modal" id="detail-modal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">üîß –î–µ—Ç–∞–ª–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞</div>
        <button class="modal-close" id="detail-modal-close">&times;</button>
      </div>
      <div class="modal-body" id="detail-modal-body">
        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
      </div>
    </div>
  </div>
  
  <div class="notification" id="notification">
    <span class="notification-icon">‚ÑπÔ∏è</span>
    <span id="notification-text">–°–æ–æ–±—â–µ–Ω–∏–µ</span>
  </div>

  <script>
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    let tools = JSON.parse(localStorage.getItem('tools')) || [];
    let pendingTool = null; // –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –æ–∂–∏–¥–∞—é—â–∏–π –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
    const MAX_TOOLS = 50;
    const MAX_IMAGE_SIZE = 800; // –ü–∏–∫—Å–µ–ª–µ–π
    const IMAGE_QUALITY = 0.7; // 70% –∫–∞—á–µ—Å—Ç–≤–∞
    const MAX_FILE_SIZE = 10 * 1024 * 1024; // 10 MB
    
    // –ó–ê–ú–ï–ù–ò–¢–ï –ù–ê –í–ê–® –†–ï–ê–õ–¨–ù–´–ô URL –° RENDER.COM
    const BACKEND_URL = 'https://toolmanager-ai.onrender.com';
    
    // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
    const dropArea = document.getElementById('drop-area');
    const fileInput = document.getElementById('file-input');
    const gallery = document.getElementById('gallery');
    const serverStatusEl = document.getElementById('server-status');
    const totalCountEl = document.getElementById('total-count');
    const aiCountEl = document.getElementById('ai-count');
    const toolsCountEl = document.getElementById('tools-count');
    const storageUsageEl = document.getElementById('storage-usage');
    const storageFillEl = document.getElementById('storage-fill');
    const notification = document.getElementById('notification');
    const notificationText = document.getElementById('notification-text');
    const compareModal = document.getElementById('compare-modal');
    const modalBody = document.getElementById('modal-body');
    const modalClose = document.getElementById('modal-close');
    const detailModal = document.getElementById('detail-modal');
    const detailModalBody = document.getElementById('detail-modal-body');
    const detailModalClose = document.getElementById('detail-modal-close');
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    document.addEventListener('DOMContentLoaded', () => {
      init();
    });
    
    async function init() {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É
      await checkServerConnection();
      
      // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –≥–∞–ª–µ—Ä–µ—é
      renderGallery();
      
      // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
      updateStats();
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
      updateStorageInfo();
      
      // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
      setupEventListeners();
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
      setTimeout(() => {
        showNotification('‚úÖ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —É–ª—É—á—à–µ–Ω–Ω—ã–π ToolManager AI!', 'success');
      }, 500);
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É
    async function checkServerConnection() {
      try {
        const response = await fetch(`${BACKEND_URL}/health`, {
          method: 'GET',
          headers: { 'Content-Type': 'application/json' }
        });
        
        if (response.ok) {
          const data = await response.json();
          serverStatusEl.className = 'status-card ok';
          serverStatusEl.innerHTML = `
            <span class="status-icon">‚úÖ</span>
            <span><strong>–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ –ò–ò!</strong><br>
            <small>–ú–æ–¥–µ–ª—å: ${data.model || 'LLaVA 13B'}</small></span>
          `;
          return true;
        }
        
        throw new Error('–°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É');
        
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É:', error);
        serverStatusEl.className = 'status-card error';
        serverStatusEl.innerHTML = `
          <span class="status-icon">‚ùå</span>
          <span><strong>–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ò–ò</strong><br>
          <small>–†–∞–±–æ—Ç–∞–µ—Ç —Ä–µ–∑–µ—Ä–≤–Ω—ã–π —Ä–µ–∂–∏–º –±–µ–∑ –ò–ò</small></span>
        `;
        return false;
      }
    }
    
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
    function setupEventListeners() {
      // –ö–ª–∏–∫ –ø–æ –æ–±–ª–∞—Å—Ç–∏ –∑–∞–≥—Ä—É–∑–∫–∏
      dropArea.addEventListener('click', () => {
        fileInput.click();
      });
      
      // –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
      ['dragover', 'dragenter'].forEach(event => {
        dropArea.addEventListener(event, (e) => {
          e.preventDefault();
          dropArea.style.borderColor = 'var(--primary)';
          dropArea.style.backgroundColor = 'rgba(255, 255, 255, 1)';
        });
      });
      
      ['dragleave', 'dragend'].forEach(event => {
        dropArea.addEventListener(event, () => {
          dropArea.style.borderColor = '';
          dropArea.style.backgroundColor = '';
        });
      });
      
      // –°–±—Ä–æ—Å —Ñ–∞–π–ª–æ–≤
      dropArea.addEventListener('drop', (e) => {
        e.preventDefault();
        dropArea.style.borderColor = '';
        dropArea.style.backgroundColor = '';
        
        if (e.dataTransfer.files.length > 0) {
          handleFiles(e.dataTransfer.files);
        }
      });
      
      // –í—ã–±–æ—Ä —Ñ–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ –¥–∏–∞–ª–æ–≥
      fileInput.addEventListener('change', (e) => {
        if (e.target.files.length > 0) {
          handleFiles(e.target.files);
        }
        fileInput.value = ''; // –°–±—Ä–æ—Å –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
      });
      
      // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
      modalClose.addEventListener('click', () => {
        compareModal.classList.remove('active');
      });
      
      detailModalClose.addEventListener('click', () => {
        detailModal.classList.remove('active');
      });
      
      // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –µ–≥–æ
      window.addEventListener('click', (e) => {
        if (e.target === compareModal) {
          compareModal.classList.remove('active');
        }
        if (e.target === detailModal) {
          detailModal.classList.remove('active');
        }
      });
    }
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
    async function handleFiles(files) {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–∏–º–∏—Ç
      if (tools.length + files.length > MAX_TOOLS) {
        const canAdd = MAX_TOOLS - tools.length;
        showNotification(`‚ö†Ô∏è –õ–∏–º–∏—Ç: ${MAX_TOOLS} –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤. –ú–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ ${canAdd} —Ñ–∞–π–ª–æ–≤.`, 'warning');
        return;
      }
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞
      for (let i = 0; i < files.length; i++) {
        if (files[i].size > MAX_FILE_SIZE) {
          showNotification(`‚ö†Ô∏è –§–∞–π–ª "${files[i].name}" —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 10 –ú–ë`, 'warning');
          return;
        }
      }
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
      showLoading(`–ê–Ω–∞–ª–∏–∑ ${files.length} –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å –ø–æ–º–æ—â—å—é –ò–ò...`);
      
      // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∂–¥—ã–π —Ñ–∞–π–ª
      for (let i = 0; i < files.length; i++) {
        const file = files[i];
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        if (!file.type.match('image.*')) {
          console.warn(`–§–∞–π–ª ${file.name} –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º`);
          continue;
        }
        
        try {
          // –°–∂–∏–º–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
          const compressedImage = await compressImage(file);
          
          // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –∞–Ω–∞–ª–∏–∑ –ò–ò
          const aiResult = await analyzeImageWithAI(compressedImage);
          
          // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
          const newTool = {
            id: Date.now() + i,
            name: aiResult.name || `–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç ${tools.length + 1}`,
            type: aiResult.type || '—Ä—É—á–Ω–æ–π',
            image: compressedImage,
            confidence: aiResult.confidence || 0.85,
            date: new Date().toISOString(),
            aiRecognized: true,
            details: aiResult.details || {
              features: ['–†–∞—Å–ø–æ–∑–Ω–∞–Ω–æ –ò–ò'],
              materials: ['–°—Ç–∞–ª—å', '–ü–ª–∞—Å—Ç–∏–∫'],
              usage: ['–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ'],
              precision: '–•–æ—Ä–æ—à–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å'
            },
            imageHash: generateImageHash(compressedImage) // –•–µ—à –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
          };
          
          // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
          pendingTool = newTool;
          
          // –ò—â–µ–º –ø–æ—Ö–æ–∂–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
          const similarTools = findSimilarTools(newTool);
          
          if (similarTools.length > 0) {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤—ã–±–æ—Ä–∞ –¥–µ–π—Å—Ç–≤–∏—è
            showCompareModal(newTool, similarTools);
          } else {
            // –ù–µ—Ç –ø–æ—Ö–æ–∂–∏—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤, –¥–æ–±–∞–≤–ª—è–µ–º —Å—Ä–∞–∑—É
            tools.push(newTool);
            saveToolsSafe();
            showNotification(`‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç: ${newTool.name}`, 'success');
          }
          
        } catch (error) {
          console.error(`–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–∞ ${i + 1}:`, error);
          
          // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ 413 (—Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π —Ä–∞–∑–º–µ—Ä)
          if (error.message.includes('413') || error.message.includes('Payload too large')) {
            showNotification(`‚ö†Ô∏è –§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–º–µ–Ω—å—à–µ.`, 'warning');
            continue;
          }
          
          // –†–µ–∑–µ—Ä–≤–Ω—ã–π —Ä–µ–∂–∏–º –ø—Ä–∏ –æ—à–∏–±–∫–µ –ò–ò
          const compressedImage = await compressImage(file);
          const fallbackTool = {
            id: Date.now() + i,
            name: `–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç ${tools.length + 1} (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π —Ä–µ–∂–∏–º)`,
            type: getRandomToolType(),
            image: compressedImage,
            confidence: 0.75,
            date: new Date().toISOString(),
            aiRecognized: false,
            details: {
              features: ['–†–∞—Å–ø–æ–∑–Ω–∞–Ω–æ –≤ —Ä–µ–∑–µ—Ä–≤–Ω–æ–º —Ä–µ–∂–∏–º–µ'],
              materials: ['–°—Ç–∞–ª—å', '–ü–ª–∞—Å—Ç–∏–∫'],
              usage: ['–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ'],
              precision: '–ë–∞–∑–æ–≤–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å'
            },
            imageHash: generateImageHash(compressedImage)
          };
          
          tools.push(fallbackTool);
          saveToolsSafe();
          
          showNotification(`‚ö†Ô∏è –§–∞–π–ª ${i + 1}: ${error.message || '–û—à–∏–±–∫–∞ –ò–ò, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω —Ä–µ–∑–µ—Ä–≤–Ω—ã–π —Ä–µ–∂–∏–º'}`, 'warning');
        }
      }
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
      renderGallery();
      updateStats();
      updateStorageInfo();
    }
    
    // –ê–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ –ò–ò
    async function analyzeImageWithAI(imageUrl) {
      try {
        console.log('üöÄ –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ –ò–ò...');
        
        const response = await fetch(`${BACKEND_URL}/api/analyze-tool`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ image: imageUrl })
        });
        
        if (!response.ok) {
          const errorData = await response.json().catch(() => ({}));
          
          // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ 413
          if (response.status === 413) {
            throw new Error('413: Payload too large. –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–µ.');
          }
          
          throw new Error(errorData.error || `HTTP ${response.status}`);
        }
        
        const result = await response.json();
        console.log('‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç –ò–ò:', result);
        
        return result;
        
      } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ –ò–ò:', error);
        throw error;
      }
    }
    
    // –°–∂–∞—Ç–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ä–∞–∑–º–µ—Ä–∞
    function compressImage(file) {
      return new Promise((resolve, reject) => {
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞
        if (file.size > MAX_FILE_SIZE) {
          return reject(new Error("–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 10 –ú–ë"));
        }
        
        const reader = new FileReader();
        
        reader.onload = (e) => {
          const img = new Image();
          img.src = e.target.result;
          
          img.onload = () => {
            const canvas = document.createElement('canvas');
            
            // –£–º–µ–Ω—å—à–∞–µ–º –¥–æ 800 –ø–∏–∫—Å–µ–ª–µ–π
            const MAX_SIZE = 800;
            const scale = Math.min(1, MAX_SIZE / Math.max(img.width, img.height));
            
            canvas.width = img.width * scale;
            canvas.height = img.height * scale;
            
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
            
            // –°–Ω–∞—á–∞–ª–∞ —Å–∂–∏–º–∞–µ–º –¥–æ 70% –∫–∞—á–µ—Å—Ç–≤–∞
            canvas.toBlob(
              (blob) => {
                if (!blob) {
                  return reject(new Error('–û—à–∏–±–∫–∞ —Å–∂–∞—Ç–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è'));
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ —Å–∂–∞—Ç–∏—è
                if (blob.size <= 5 * 1024 * 1024) {
                  convertToBase64(blob, resolve, reject);
                } else {
                  // –ï—Å–ª–∏ –≤—Å—ë –µ—â—ë —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π - —Å–∂–∏–º–∞–µ–º –µ—â—ë —Å–∏–ª—å–Ω–µ–µ
                  canvas.toBlob(
                    (blob2) => {
                      if (blob2.size > 5 * 1024 * 1024) {
                        reject(new Error("–°–∂–∞—Ç–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ."));
                      } else {
                        convertToBase64(blob2, resolve, reject);
                      }
                    },
                    'image/jpeg',
                    0.5 // –°–∏–ª—å–Ω–µ–µ —Å–∂–∞—Ç–∏–µ
                  );
                }
              },
              'image/jpeg',
              IMAGE_QUALITY
            );
          };
          
          img.onerror = reject;
        };
        
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }
    
    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤ base64
    function convertToBase64(blob, resolve, reject) {
      const reader = new FileReader();
      reader.onload = e => resolve(e.target.result);
      reader.onerror = reject;
      reader.readAsDataURL(blob);
    }
    
    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ö–µ—à–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
    function generateImageHash(imageUrl) {
      // –ò–∑–≤–ª–µ–∫–∞–µ–º —á–∏—Å—Ç—ã–π base64 –±–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞
      const base64 = imageUrl.split(',')[1];
      
      // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç–æ–π —Ö–µ—à –∏–∑ –ø–µ—Ä–≤—ã—Ö 100 —Å–∏–º–≤–æ–ª–æ–≤
      return base64.substring(0, 100);
    }
    
    // –ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
    function findSimilarTools(newTool) {
      const similarTools = [];
      
      tools.forEach(tool => {
        let similarityScore = 0;
        
        // –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é (40% –≤–µ—Å–∞)
        if (newTool.name && tool.name) {
          const nameSimilarity = calculateStringSimilarity(newTool.name, tool.name);
          similarityScore += nameSimilarity * 0.4;
        }
        
        // –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ —Ç–∏–ø—É (30% –≤–µ—Å–∞)
        if (newTool.type === tool.type) {
          similarityScore += 0.3;
        }
        
        // –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ —Ö–µ—à—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (30% –≤–µ—Å–∞)
        if (newTool.imageHash && tool.imageHash) {
          const hashSimilarity = calculateHashSimilarity(newTool.imageHash, tool.imageHash);
          similarityScore += hashSimilarity * 0.3;
        }
        
        // –ï—Å–ª–∏ —Å—Ö–æ–¥—Å—Ç–≤–æ –±–æ–ª—å—à–µ 60%, –¥–æ–±–∞–≤–ª—è–µ–º –≤ —Å–ø–∏—Å–æ–∫
        if (similarityScore > 0.6) {
          similarTools.push({
            ...tool,
            similarityScore: Math.round(similarityScore * 100)
          });
        }
      });
      
      // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —É–±—ã–≤–∞–Ω–∏—é —Å—Ö–æ–¥—Å—Ç–≤–∞
      return similarTools.sort((a, b) => b.similarityScore - a.similarityScore).slice(0, 5);
    }
    
    // –†–∞—Å—á–µ—Ç —Å—Ö–æ–∂–µ—Å—Ç–∏ —Å—Ç—Ä–æ–∫
    function calculateStringSimilarity(str1, str2) {
      const s1 = str1.toLowerCase();
      const s2 = str2.toLowerCase();
      
      if (s1 === s2) return 1.0;
      if (s1.includes(s2) || s2.includes(s1)) return 0.8;
      
      // –ü—Ä–æ—Å—Ç–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ –æ–±—â–∏–º —Å–ª–æ–≤–∞–º
      const words1 = s1.split(/\s+/);
      const words2 = s2.split(/\s+/);
      const commonWords = words1.filter(w => words2.includes(w)).length;
      
      return Math.min(0.7, commonWords * 0.25);
    }
    
    // –†–∞—Å—á–µ—Ç —Å—Ö–æ–∂–µ—Å—Ç–∏ —Ö–µ—à–µ–π
    function calculateHashSimilarity(hash1, hash2) {
      // –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ 50 —Å–∏–º–≤–æ–ª–æ–≤ —Ö–µ—à–µ–π
      const maxLength = Math.min(hash1.length, hash2.length, 50);
      let matches = 0;
      
      for (let i = 0; i < maxLength; i++) {
        if (hash1[i] === hash2[i]) {
          matches++;
        }
      }
      
      return matches / maxLength;
    }
    
    // –ü–æ–∫–∞–∑ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
    function showCompareModal(newTool, similarTools) {
      modalBody.innerHTML = `
        <div class="compare-info">
          <strong>‚ö†Ô∏è –ù–∞–π–¥–µ–Ω—ã –ø–æ—Ö–æ–∂–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã!</strong><br>
          –í–æ–∑–º–æ–∂–Ω–æ, —ç—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —É–∂–µ –µ—Å—Ç—å –≤ –≤–∞—à–µ–π –±–∞–∑–µ. –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –∏–ª–∏ –æ—Ç–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ:
        </div>
        
        <div class="compare-section">
          <div class="compare-title">üì∑ –ù–æ–≤—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç</div>
          <div style="display: flex; align-items: center; gap: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
            <img src="${newTool.image}" alt="${newTool.name}" style="width: 120px; height: 120px; object-fit: cover; border-radius: 8px;">
            <div>
              <div style="font-size: 1.3rem; font-weight: 700; color: var(--dark);">${newTool.name}</div>
              <div style="font-size: 1.1rem; color: var(--primary); margin: 5px 0;">${newTool.type}</div>
              <div style="color: var(--gray);">–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –ò–ò: ${(newTool.confidence * 100).toFixed(0)}%</div>
            </div>
          </div>
        </div>
        
        <div class="compare-section">
          <div class="compare-title">‚úèÔ∏è –†—É—á–Ω–∞—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞</div>
          <div class="edit-form">
            <div class="form-group">
              <label for="tool-name">–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
              <input type="text" id="tool-name" value="${newTool.name}" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–æ—á–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ">
            </div>
            <div class="form-group">
              <label for="tool-type">–¢–∏–ø:</label>
              <select id="tool-type">
                <option value="—Ä—É—á–Ω–æ–π" ${newTool.type === '—Ä—É—á–Ω–æ–π' ? 'selected' : ''}>–†—É—á–Ω–æ–π</option>
                <option value="—ç–ª–µ–∫—Ç—Ä–æ" ${newTool.type === '—ç–ª–µ–∫—Ç—Ä–æ' ? 'selected' : ''}>–≠–ª–µ–∫—Ç—Ä–æ</option>
                <option value="–∏–∑–º–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–π" ${newTool.type === '–∏–∑–º–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–π' ? 'selected' : ''}>–ò–∑–º–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–π</option>
                <option value="—Ä–µ–∂—É—â–∏–π" ${newTool.type === '—Ä–µ–∂—É—â–∏–π' ? 'selected' : ''}>–†–µ–∂—É—â–∏–π</option>
                <option value="—É–¥–∞—Ä–Ω—ã–π" ${newTool.type === '—É–¥–∞—Ä–Ω—ã–π' ? 'selected' : ''}>–£–¥–∞—Ä–Ω—ã–π</option>
                <option value="–∑–∞–∂–∏–º–Ω–æ–π" ${newTool.type === '–∑–∞–∂–∏–º–Ω–æ–π' ? 'selected' : ''}>–ó–∞–∂–∏–º–Ω–æ–π</option>
              </select>
            </div>
            <div class="form-group">
              <label for="tool-confidence">–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å:</label>
              <input type="range" id="tool-confidence" min="0.5" max="1.0" step="0.01" value="${newTool.confidence}">
              <div class="confidence-display" id="confidence-display">${(newTool.confidence * 100).toFixed(0)}%</div>
            </div>
          </div>
        </div>
        
        <div class="compare-section">
          <div class="compare-title">üîç –ü–æ—Ö–æ–∂–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –≤ –±–∞–∑–µ</div>
          ${similarTools.length > 0 ? `
            <div class="compare-grid">
              ${similarTools.map(tool => `
                <div class="compare-item similar" onclick="selectSimilarTool(${tool.id})">
                  <img src="${tool.image}" alt="${tool.name}">
                  <div class="compare-name">${tool.name}</div>
                  <div class="compare-type">${tool.type}</div>
                  <div class="compare-score">–°—Ö–æ–¥—Å—Ç–≤–æ: ${tool.similarityScore}%</div>
                </div>
              `).join('')}
            </div>
          ` : `
            <div style="text-align: center; padding: 30px; color: var(--gray);">
              –ü–æ—Ö–æ–∂–∏—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
            </div>
          `}
        </div>
        
        <div class="compare-actions">
          <button class="btn btn-primary" onclick="addNewTool()">
            <span>‚ûï</span>
            <span>–î–æ–±–∞–≤–∏—Ç—å –∫–∞–∫ –Ω–æ–≤—ã–π</span>
          </button>
          <button class="btn btn-secondary" onclick="replaceSimilarTool()">
            <span>üîÑ</span>
            <span>–ó–∞–º–µ–Ω–∏—Ç—å –ø–æ—Ö–æ–∂–∏–π</span>
          </button>
          <button class="btn btn-danger" onclick="cancelAddTool()">
            <span>‚ùå</span>
            <span>–û—Ç–º–µ–Ω–∏—Ç—å</span>
          </button>
        </div>
      `;
      
      // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–∑—É–Ω–∫–∞
      const confidenceSlider = document.getElementById('tool-confidence');
      const confidenceDisplay = document.getElementById('confidence-display');
      
      if (confidenceSlider && confidenceDisplay) {
        confidenceSlider.addEventListener('input', function() {
          confidenceDisplay.textContent = (this.value * 100).toFixed(0) + '%';
        });
      }
      
      compareModal.classList.add('active');
    }
    
    // –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
    function addNewTool() {
      if (pendingTool) {
        // –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ —Ñ–æ—Ä–º—ã
        const name = document.getElementById('tool-name').value;
        const type = document.getElementById('tool-type').value;
        const confidence = parseFloat(document.getElementById('tool-confidence').value);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
        pendingTool.name = name;
        pendingTool.type = type;
        pendingTool.confidence = confidence;
        
        tools.push(pendingTool);
        saveToolsSafe();
        showNotification(`‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç: ${name}`, 'success');
        pendingTool = null;
        compareModal.classList.remove('active');
        renderGallery();
        updateStats();
      }
    }
    
    // –ó–∞–º–µ–Ω–∏—Ç—å –ø–æ—Ö–æ–∂–∏–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
    function replaceSimilarTool() {
      if (pendingTool && selectedSimilarToolId !== null) {
        // –ù–∞—Ö–æ–¥–∏–º –∏ –∑–∞–º–µ–Ω—è–µ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
        const index = tools.findIndex(t => t.id === selectedSimilarToolId);
        if (index !== -1) {
          const oldName = tools[index].name;
          
          // –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ —Ñ–æ—Ä–º—ã
          const name = document.getElementById('tool-name').value;
          const type = document.getElementById('tool-type').value;
          const confidence = parseFloat(document.getElementById('tool-confidence').value);
          
          // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
          pendingTool.name = name;
          pendingTool.type = type;
          pendingTool.confidence = confidence;
          
          tools[index] = pendingTool;
          saveToolsSafe();
          showNotification(`‚úÖ –ó–∞–º–µ–Ω–µ–Ω –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç "${oldName}" –Ω–∞ "${name}"`, 'success');
          pendingTool = null;
          selectedSimilarToolId = null;
          compareModal.classList.remove('active');
          renderGallery();
          updateStats();
        }
      }
    }
    
    // –û—Ç–º–µ–Ω–∏—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ
    function cancelAddTool() {
      pendingTool = null;
      selectedSimilarToolId = null;
      compareModal.classList.remove('active');
      showNotification('‚ÑπÔ∏è –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ', 'info');
    }
    
    // –í—ã–±—Ä–∞—Ç—å –ø–æ—Ö–æ–∂–∏–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –∑–∞–º–µ–Ω—ã
    let selectedSimilarToolId = null;
    window.selectSimilarTool = function(toolId) {
      selectedSimilarToolId = toolId;
      
      // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç
      document.querySelectorAll('.compare-item').forEach(item => {
        item.style.borderColor = '#dee2e6';
        item.style.borderWidth = '2px';
      });
      
      const selectedItem = document.querySelector(`.compare-item:nth-child(${tools.findIndex(t => t.id === toolId) + 1})`);
      if (selectedItem) {
        selectedItem.style.borderColor = 'var(--primary)';
        selectedItem.style.borderWidth = '3px';
      }
      
      showNotification(`–í—ã–±—Ä–∞–Ω –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –∑–∞–º–µ–Ω—ã`, 'info');
    };
    
    // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ª—É—á–∞–π–Ω–æ–≥–æ —Ç–∏–ø–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
    function getRandomToolType() {
      const types = ['—Ä—É—á–Ω–æ–π', '—ç–ª–µ–∫—Ç—Ä–æ', '–∏–∑–º–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–π', '—Ä–µ–∂—É—â–∏–π', '—É–¥–∞—Ä–Ω—ã–π', '–∑–∞–∂–∏–º–Ω–æ–π'];
      return types[Math.floor(Math.random() * types.length)];
    }
    
    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≥–∞–ª–µ—Ä–µ–∏
    function renderGallery() {
      if (tools.length === 0) {
        gallery.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">üìÅ</div>
            <h2 class="empty-title">–ù–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤</h2>
            <p class="empty-text">
              –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —Å –ø–æ–º–æ—â—å—é –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞
            </p>
            <button class="empty-button" onclick="document.getElementById('file-input').click()">
              <span>üì∑</span>
              <span>–î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ</span>
            </button>
          </div>
        `;
        return;
      }
      
      // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ –ø–µ—Ä–≤—ã–º–∏)
      const sortedTools = [...tools].sort((a, b) => new Date(b.date) - new Date(a.date));
      
      gallery.innerHTML = sortedTools.map(tool => `
        <div class="tool-card" onclick="showToolDetail(${tool.id})">
          <div class="badge">ü§ñ –ò–ò</div>
          <img src="${tool.image}" alt="${tool.name}" class="tool-image">
          <div class="tool-content">
            <div class="tool-name">${tool.name}</div>
            <div class="tool-type">${tool.type}</div>
            <div class="tool-meta">
              <span>üìÖ ${formatDate(tool.date)}</span>
              <span class="tool-confidence">${(tool.confidence * 100).toFixed(0)}%</span>
            </div>
          </div>
        </div>
      `).join('');
    }
    
    // –ü–æ–∫–∞–∑ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –≤–∏–¥–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
    function showToolDetail(toolId) {
      const tool = tools.find(t => t.id === toolId);
      if (!tool) return;
      
      detailModalBody.innerHTML = `
        <div style="display: flex; gap: 30px;">
          <div style="flex: 1;">
            <img src="${tool.image}" alt="${tool.name}" style="width: 100%; height: 300px; object-fit: cover; border-radius: 8px;">
          </div>
          <div style="flex: 1;">
            <h2 style="font-size: 2rem; font-weight: 800; color: var(--dark); margin-bottom: 20px;">${tool.name}</h2>
            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
              <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                <span style="font-weight: 600; color: var(--dark);">–¢–∏–ø:</span>
                <span style="color: var(--primary); font-weight: 600;">${tool.type}</span>
              </div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                <span style="font-weight: 600; color: var(--dark);">–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å:</span>
                <span style="color: var(--success); font-weight: 600;">${(tool.confidence * 100).toFixed(0)}%</span>
              </div>
              <div style="display: flex; justify-content: space-between;">
                <span style="font-weight: 600; color: var(--dark);">–¢–æ—á–Ω–æ—Å—Ç—å:</span>
                <span style="color: var(--gray);">${tool.details.precision}</span>
              </div>
            </div>
            
            <div class="tool-detail">
              <h3 class="detail-title">–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏</h3>
              <ul class="detail-features">
                ${tool.details.features.map(f => `<li>${f}</li>`).join('')}
              </ul>
            </div>
            
            <div class="tool-detail" style="margin-top: 20px;">
              <h3 class="detail-title">–ú–∞—Ç–µ—Ä–∏–∞–ª—ã</h3>
              <ul class="detail-materials">
                ${tool.details.materials.map(m => `<li>${m}</li>`).join('')}
              </ul>
            </div>
            
            <div class="tool-detail" style="margin-top: 20px;">
              <h3 class="detail-title">–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ</h3>
              <ul class="detail-usage">
                ${tool.details.usage.map(u => `<li>${u}</li>`).join('')}
              </ul>
            </div>
          </div>
        </div>
        
        <div style="margin-top: 30px; text-align: center;">
          <button class="btn btn-primary" onclick="detailModal.classList.remove('active')">
            <span>√ó</span>
            <span>–ó–∞–∫—Ä—ã—Ç—å</span>
          </button>
        </div>
      `;
      
      detailModal.classList.add('active');
    }
    
    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã
    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleDateString('ru-RU', {
        day: '2-digit',
        month: 'short',
        year: 'numeric'
      });
    }
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    function updateStats() {
      totalCountEl.textContent = tools.length;
      aiCountEl.textContent = tools.filter(t => t.aiRecognized).length;
      toolsCountEl.textContent = tools.length;
    }
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
    function updateStorageInfo() {
      try {
        const storageUsed = (JSON.stringify(tools).length / (5 * 1024 * 1024)) * 100;
        const usagePercent = Math.min(100, storageUsed);
        
        storageUsageEl.textContent = usagePercent.toFixed(1);
        storageFillEl.style.width = `${usagePercent}%`;
        
        // –ú–µ–Ω—è–µ–º —Ü–≤–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è
        if (usagePercent > 80) {
          storageFillEl.style.background = 'var(--error)';
        } else if (usagePercent > 50) {
          storageFillEl.style.background = 'var(--warning)';
        } else {
          storageFillEl.style.background = 'var(--primary)';
        }
      } catch (e) {
        console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ:', e);
      }
    }
    
    // –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage
    function saveToolsSafe() {
      try {
        localStorage.setItem('tools', JSON.stringify(tools));
      } catch (e) {
        if (e.name === 'QuotaExceededError') {
          console.warn('localStorage –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω, –æ—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ');
          
          // –£–¥–∞–ª—è–µ–º —Å–∞–º—ã–µ —Å—Ç–∞—Ä—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
          while (tools.length > 20 && tools.length > 0) {
            tools.shift();
          }
          
          // –ü—ã—Ç–∞–µ–º—Å—è —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–Ω–æ–≤–∞
          try {
            localStorage.setItem('tools', JSON.stringify(tools));
            showNotification('‚ö†Ô∏è –û—á–∏—â–µ–Ω—ã —Å—Ç–∞—Ä—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞', 'warning');
          } catch (e2) {
            console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏:', e2);
            showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö', 'error');
          }
        } else {
          console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', e);
          showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö', 'error');
        }
      }
    }
    
    // –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
    function clearOldTools() {
      if (tools.length === 0) {
        showNotification('‚ÑπÔ∏è –ù–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏', 'warning');
        return;
      }
      
      if (confirm(`–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ ${tools.length} —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤? –≠—Ç–æ –æ—Å–≤–æ–±–æ–¥–∏—Ç –º–µ—Å—Ç–æ –¥–ª—è –Ω–æ–≤—ã—Ö.`)) {
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π
        const recentTools = tools.slice(-5);
        
        if (recentTools.length > 0 && confirm(`–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ ${recentTools.length} –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤?`)) {
          tools = recentTools;
        } else {
          tools = [];
        }
        
        localStorage.setItem('tools', JSON.stringify(tools));
        renderGallery();
        updateStats();
        updateStorageInfo();
        showNotification(`‚úÖ –û—á–∏—â–µ–Ω–æ! –û—Å—Ç–∞–ª–æ—Å—å ${tools.length} –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤`, 'success');
      }
    }
    
    // –ü–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    function showNotification(message, type = 'info') {
      notificationText.textContent = message;
      notification.className = `notification ${type} show`;
      
      // –ò–∫–æ–Ω–∫–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
      const icons = {
        success: '‚úÖ',
        error: '‚ùå',
        warning: '‚ö†Ô∏è',
        info: '‚ÑπÔ∏è'
      };
      
      document.querySelector('.notification-icon').textContent = icons[type] || '‚ÑπÔ∏è';
      
      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 3.5 —Å–µ–∫—É–Ω–¥—ã
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3500);
    }
    
    // –ü–æ–∫–∞–∑ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∑–∞–≥—Ä—É–∑–∫–∏
    function showLoading(message = '–ó–∞–≥—Ä—É–∑–∫–∞...') {
      gallery.innerHTML = `
        <div class="loading">
          <div class="spinner"></div>
          <p style="font-size: 1.4rem; margin-bottom: 15px;">${message}</p>
          <p style="opacity: 0.9; max-width: 500px; margin: 0 auto;">
            –°–∂–∞—Ç–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–æ 800 –ø–∏–∫—Å–µ–ª–µ–π –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞ –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –æ—à–∏–±–∫–∏ 413
          </p>
        </div>
      `;
    }
    
    // –ü–æ–∫–∞–∑ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø—Ä–æ–µ–∫—Ç–µ
    function showAbout() {
      alert(`üîß ToolManager AI\n\n–í–µ—Ä—Å–∏—è: 1.1.0 (–£–ª—É—á—à–µ–Ω–Ω–∞—è)\n–î–∞—Ç–∞: –Ø–Ω–≤–∞—Ä—å 2026\n\n–£–ª—É—á—à–µ–Ω–∏—è:\n- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ 413 (—Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π —Ä–∞–∑–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞)\n- –°–∂–∞—Ç–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–æ 800 –ø–∏–∫—Å–µ–ª–µ–π –∏ 70% –∫–∞—á–µ—Å—Ç–≤–∞\n- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π (–º–∞–∫—Å. 10 –ú–ë)\n- –£–ª—É—á—à–µ–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –ò–ò —Å –±–æ–ª–µ–µ —Ç–æ—á–Ω—ã–º–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏\n- –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–∞—Ä—Å–µ—Ä –æ—Ç–≤–µ—Ç–æ–≤ –ò–ò —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ñ–æ—Ä–º–∞—Ç–∞\n- –†—É—á–Ω–∞—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º`);
    }
    
    // –ü–æ–∫–∞–∑ —Å–ø—Ä–∞–≤–∫–∏
    function showHelp() {
      alert(`‚ùì –ü–æ–º–æ—â—å –ø–æ —É–ª—É—á—à–µ–Ω–Ω–æ–º—É ToolManager AI\n\nüì∑ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤:\n- –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–æ—Ç–æ –≤ –æ–±–ª–∞—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏\n- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: 10 –ú–ë (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞)\n- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–∂–∏–º–∞—é—Ç—Å—è –¥–æ 800 –ø–∏–∫—Å–µ–ª–µ–π –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –æ—à–∏–±–∫–∏ 413\n\nü§ñ –£–ª—É—á—à–µ–Ω–Ω–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –ò–ò:\n- –ê–Ω–∞–ª–∏–∑ –∑–∞–Ω–∏–º–∞–µ—Ç 15-25 —Å–µ–∫—É–Ω–¥ (–ø–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å)\n- –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã: 5-10 —Å–µ–∫—É–Ω–¥\n- –£–ª—É—á—à–µ–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –¥–ª—è –ò–ò`);
    }
    
    // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
    window.addNewTool = addNewTool;
    window.replaceSimilarTool = replaceSimilarTool;
    window.cancelAddTool = cancelAddTool;
    window.selectSimilarTool = selectSimilarTool;
    window.showToolDetail = showToolDetail;
  </script>
</body>
</html>